{-# OPTIONS --guardedness --rewriting --cubical #-}

{-|
# Braid Groups and Semantic Groupoids

This module implements Section 4.4 (continued) of Belfiore & Bennequin (2022):
- **Artin braid group Bâ‚ƒ** with generators Ïƒâ‚, Ïƒâ‚‚
- **Fundamental groupoid** Î (Î›â˜…_â„‚) = Bâ‚ƒ
- **Quotient groups**: Bâ‚ƒ/C, PSLâ‚‚(â„¤), SLâ‚‚(â„¤), ğ”–â‚ƒ
- **Real points groupoid** Bâ‚ƒ(â„)
- **Culioli groupoid** BÂ³áµ£ = Î áµ£ over gathered surface Î£â˜…
- **Representations**: Cardan, elliptic integrals

## Key Results

1. **Braid group Bâ‚ƒ**: Ï€â‚(Î›â˜…_â„‚) for discriminant complement
   - Generators: Ïƒâ‚, Ïƒâ‚‚ (loops around cusp branches)
   - Relation: Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚ (braid relation)

2. **Center C**: Generated by c = (Ïƒâ‚Ïƒâ‚‚)Â³

3. **Quotients**:
   - Bâ‚ƒ/C â†’ PSLâ‚‚(â„¤) (MÃ¶bius group)
   - Bâ‚ƒ/C â†’ SLâ‚‚(â„¤) (modular group)
   - Bâ‚ƒ â†’ ğ”–â‚ƒ (symmetric group on 3 elements)

4. **Culioli groupoid BÂ³áµ£**: Distinguishes stable/unstable branches
   - Objects: Points of Î£â˜…
   - Morphisms: Homotopy classes of paths
   - Covering: Ï€: BÂ³áµ£ â†’ Bâ‚ƒ(â„)

## References

- [AGZV12b] Arnold et al.: Singularity Theory II (braids and monodromy)
- [Loo78] Looijenga: Real structures in complex kaleidoscope
- [Mac12] MacLane: Homological Algebra (group cohomology)
-}

module Neural.Memory.Braids where

open import 1Lab.Prelude
open import 1Lab.Path
open import 1Lab.HLevel

open import Cat.Base
open import Cat.Groupoid

open import Algebra.Group
open import Algebra.Group.Ab

open import Data.Nat.Base

-- Import from previous modules
open import Neural.Memory.Catastrophe using (â„; Î›; Î”; Î›â˜…; Î£; Î£â˜…; discriminant)

--------------------------------------------------------------------------------
-- Â§4.4: Artin Braid Group Bâ‚ƒ

{-|
## The Braid Group Bâ‚ƒ

> "The ambiguity in distinguishing individual roots along a path is contained
>  in the PoincarÃ© fundamental group Ï€â‚(Î›â˜…_â„‚). However the precise definition
>  of this group requires the choice of a base point in Î›â˜…_â„‚, then it is more
>  convenient to consider the fundamental groupoid Î (Î›â˜…_â„‚) = Bâ‚ƒ." (p. 106)

**Fundamental groupoid**:
- Objects: Points in Î›â˜…_â„‚ (parameters avoiding discriminant)
- Morphisms: Homotopy classes of paths

**Fundamental group** (at basepoint Î»â‚€):
- Ï€â‚(Î›â˜…_â„‚; Î»â‚€) = Aut(Î»â‚€) in Bâ‚ƒ
- Isomorphic to **Artin braid group Bâ‚ƒ**

**Generators**: Ïƒâ‚, Ïƒâ‚‚ (see Figure 4.3, p. 106)

**Construction**:
> "Take a line u = uâ‚€ âˆˆ â„â» âŠ‚ â„‚, with complex coordinate v, and let vâºâ‚€, vâ»â‚€
>  be the positive and negative square roots of -(4/27)uÂ³â‚€; the loop Ïƒâ‚ = Ïƒâº
>  (resp. Ïƒâ‚‚ = Ïƒâ») is based in 0, contained in the line u = uâ‚€ and makes one
>  turn in the trigonometric sense around vâºâ‚€ (resp. vâ»â‚€)."

**Relation**: Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚ (the braid relation)

**DNN Interpretation**:
- Tracking roots of P_uv as (u,v) varies
- Ïƒâ‚, Ïƒâ‚‚: Loops exchanging roots
- Braid relation: Different ways to exchange all 3 roots give same result
- This is the **algebraic structure of semantic ambiguity**!
-}

-- Braid group generators (including inverses)
data Bâ‚ƒ-Generator : Type where
  Ïƒâ‚ : Bâ‚ƒ-Generator
  Ïƒâ‚‚ : Bâ‚ƒ-Generator
  Ïƒâ‚â»Â¹-gen : Bâ‚ƒ-Generator  -- Inverse of Ïƒâ‚ (opposite crossing)
  Ïƒâ‚‚â»Â¹-gen : Bâ‚ƒ-Generator  -- Inverse of Ïƒâ‚‚ (opposite crossing)

-- Braid group Bâ‚ƒ (free group on Ïƒâ‚, Ïƒâ‚‚ modulo braid relation)
data Bâ‚ƒ : Type where
  Îµ : Bâ‚ƒ  -- Identity (empty braid)
  gen : Bâ‚ƒ-Generator â†’ Bâ‚ƒ  -- Single generator
  _âˆ˜_ : Bâ‚ƒ â†’ Bâ‚ƒ â†’ Bâ‚ƒ  -- Composition (stacking braids)

  -- Braid relation: Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚
  braid-relation : gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚ â‰¡ gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚

  -- Inverse relations
  inv-Ïƒâ‚-l : gen Ïƒâ‚â»Â¹-gen âˆ˜ gen Ïƒâ‚ â‰¡ Îµ
  inv-Ïƒâ‚-r : gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚â»Â¹-gen â‰¡ Îµ
  inv-Ïƒâ‚‚-l : gen Ïƒâ‚‚â»Â¹-gen âˆ˜ gen Ïƒâ‚‚ â‰¡ Îµ
  inv-Ïƒâ‚‚-r : gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚‚â»Â¹-gen â‰¡ Îµ

  -- Group axioms
  âˆ˜-assoc : âˆ€ (bâ‚ bâ‚‚ bâ‚ƒ : Bâ‚ƒ) â†’ (bâ‚ âˆ˜ bâ‚‚) âˆ˜ bâ‚ƒ â‰¡ bâ‚ âˆ˜ (bâ‚‚ âˆ˜ bâ‚ƒ)
  âˆ˜-unit-l : âˆ€ (b : Bâ‚ƒ) â†’ Îµ âˆ˜ b â‰¡ b
  âˆ˜-unit-r : âˆ€ (b : Bâ‚ƒ) â†’ b âˆ˜ Îµ â‰¡ b

  -- Make Bâ‚ƒ a set (all paths are equal)
  Bâ‚ƒ-is-set : is-set Bâ‚ƒ

-- Inverse generators (using the inverse generator constructors)
Ïƒâ‚â»Â¹ Ïƒâ‚‚â»Â¹ : Bâ‚ƒ
Ïƒâ‚â»Â¹ = gen Ïƒâ‚â»Â¹-gen
Ïƒâ‚‚â»Â¹ = gen Ïƒâ‚‚â»Â¹-gen

-- Inverse operation (recursive definition on HIT structure)
_â»Â¹ : Bâ‚ƒ â†’ Bâ‚ƒ
Îµ â»Â¹ = Îµ
gen Ïƒâ‚ â»Â¹ = gen Ïƒâ‚â»Â¹-gen
gen Ïƒâ‚‚ â»Â¹ = gen Ïƒâ‚‚â»Â¹-gen
gen Ïƒâ‚â»Â¹-gen â»Â¹ = gen Ïƒâ‚
gen Ïƒâ‚‚â»Â¹-gen â»Â¹ = gen Ïƒâ‚‚
(bâ‚ âˆ˜ bâ‚‚) â»Â¹ = bâ‚‚ â»Â¹ âˆ˜ bâ‚ â»Â¹  -- (ab)â»Â¹ = bâ»Â¹aâ»Â¹

-- Inverse laws (follow from HIT relations for generators)
-- For composite elements, these are postulated but should be provable by induction
postulate
  âˆ˜-inv-l : âˆ€ (b : Bâ‚ƒ) â†’ b â»Â¹ âˆ˜ b â‰¡ Îµ
  âˆ˜-inv-r : âˆ€ (b : Bâ‚ƒ) â†’ b âˆ˜ b â»Â¹ â‰¡ Îµ

-- Bâ‚ƒ as a group
Bâ‚ƒ-group-on : Group-on Bâ‚ƒ
Bâ‚ƒ-group-on = to-group-on mk where
  open make-group
  mk : make-group Bâ‚ƒ
  mk .group-is-set = Bâ‚ƒ-is-set
  mk .unit = Îµ
  mk .mul = _âˆ˜_
  mk .inv = _â»Â¹
  mk .assoc = âˆ˜-assoc
  mk .invl = âˆ˜-inv-l
  mk .idl = âˆ˜-unit-l

Bâ‚ƒ-Group : Group lzero
Bâ‚ƒ-Group = el Bâ‚ƒ Bâ‚ƒ-is-set , Bâ‚ƒ-group-on

{-|
**Interpretation of Braid Relation**:

Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚ says:
- "Move root 1 over root 2, then root 2 over root 3, then root 1 over root 2"
- Equals: "Move root 2 over root 3, then root 1 over root 2, then root 2 over root 3"

Both give the same cyclic permutation (1 â†’ 2 â†’ 3 â†’ 1), but with different
"twisting" that cancels out. This is the essence of braid groups!

See Figure 4.3 in paper for visual proof.
-}

--------------------------------------------------------------------------------
-- Â§4.4: Center and Quotients

{-|
## Center of Bâ‚ƒ

> "The center C of Bâ‚ƒ is generated by c = (Ïƒâ‚Ïƒâ‚‚)Â³." (p. 106)

**Full twist**: c wraps all strands around each other 360Â°

**Why central**: c commutes with all elements of Bâ‚ƒ
- Ïƒâ‚ Â· c = c Â· Ïƒâ‚
- Ïƒâ‚‚ Â· c = c Â· Ïƒâ‚‚

**Geometric meaning**: Full rotation of root configuration
-}

-- Center element c = (Ïƒâ‚Ïƒâ‚‚)Â³
c : Bâ‚ƒ
c = (gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚) âˆ˜ (gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚) âˆ˜ (gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚)

-- Shorthand
Ïƒâ‚Ïƒâ‚‚ : Bâ‚ƒ
Ïƒâ‚Ïƒâ‚‚ = gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚

-- c as cube
c-def : c â‰¡ Ïƒâ‚Ïƒâ‚‚ âˆ˜ Ïƒâ‚Ïƒâ‚‚ âˆ˜ Ïƒâ‚Ïƒâ‚‚
c-def = refl

-- Center subgroup C generated by c
-- The center of Bâ‚ƒ consists of all elements that commute with everything
module _ where
  -- Define C as integers (â„¤) with c corresponding to 1
  -- C = { câ¿ | n âˆˆ â„¤ } â‰… â„¤
  open import Data.Int.Base using (â„¤; pos; negsuc)
  open import Data.Int.Properties using (+-assoc; +-comm)

  -- For now, represent C abstractly as a cyclic group
  postulate
    C : Group lzero
    C-generated-by-c : C â‰¡ {!!}  -- Should be â„¤ with c as generator

    -- c is central (commutes with all elements)
    c-central : âˆ€ (b : Bâ‚ƒ) â†’ b âˆ˜ c â‰¡ c âˆ˜ b

{-|
## Quotient Bâ‚ƒ/C

> "The quotient by this center is isomorphic to the group Bâ‚ƒ/C generated by
>  a = Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ and b = Ïƒâ‚Ïƒâ‚‚ satisfying aÂ² = bÂ³." (p. 106)

**Generators**:
- a = Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ (from braid relation)
- b = Ïƒâ‚Ïƒâ‚‚

**Relation**: aÂ² = bÂ³

**Structure**: This is closely related to modular group!
-}

-- Elements a, b in Bâ‚ƒ
a b : Bâ‚ƒ
a = gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚
b = gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚

-- a = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚ by braid relation
a-alt : a â‰¡ gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚‚
a-alt = braid-relation

-- Quotient group Bâ‚ƒ/C
-- For now, we represent this abstractly
postulate
  Bâ‚ƒ/C : Group lzero
  quotient-map : Bâ‚ƒ â†’ âŒ Bâ‚ƒ/C âŒŸ  -- Bâ‚ƒ â†’ underlying set of Bâ‚ƒ/C
  quotient-map-hom : is-group-hom Bâ‚ƒ-group-on (Bâ‚ƒ/C .snd) quotient-map

  -- In quotient: aÂ² = bÂ³
  -- This means quotient-map(aÂ²) = quotient-map(bÂ³)
  aÂ²-equals-bÂ³-in-quotient : quotient-map (a âˆ˜ a) â‰¡ quotient-map (b âˆ˜ b âˆ˜ b)

{-|
## Further Quotients

> "The quotient of Bâ‚ƒ/C by aÂ² is the MÃ¶bius group PSLâ‚‚(â„¤) of integral
>  homographies, and the quotient of Bâ‚ƒ/C by aâ´ is the modular group SLâ‚‚(â„¤)
>  of integral matrices of determinant one, then a two fold covering of PSLâ‚‚(â„¤)."
>  (p. 106)

**Modular group SLâ‚‚(â„¤)**:
- Matrices ( a  b ) with a,b,c,d âˆˆ â„¤ and ad - bc = 1
              ( c  d )
- Fundamental in number theory, modular forms, string theory!

**MÃ¶bius group PSLâ‚‚(â„¤)**:
- Quotient SLâ‚‚(â„¤) / {Â±I}
- Acts on upper half-plane â„ by z â†¦ (az+b)/(cz+d)
- Tesselates hyperbolic plane

**Connection to elliptic curves**: Period matrix of elliptic curve
  yÂ² = zÂ³ + uz + v
gives representation Bâ‚ƒ â†’ SLâ‚‚(â„¤)
-}

-- 2Ã—2 integer matrix type
open import Data.Int.Base using (â„¤)

record Mat2Ã—2 (R : Type) : Type where
  constructor mat
  field
    a b c d : R

-- Determinant of 2Ã—2 matrix
det : Mat2Ã—2 â„¤ â†’ â„¤
det (mat a b c d) = a Data.Int.* d Data.Int.- b Data.Int.* c
  where
  open import Data.Int.Base using (_*_; _-_)

-- Modular group SLâ‚‚(â„¤): 2Ã—2 integer matrices with determinant 1
SLâ‚‚â„¤-carrier : Type
SLâ‚‚â„¤-carrier = Î£[ M âˆˆ Mat2Ã—2 â„¤ ] (det M â‰¡ Data.Int.pos 1)
  where
  open import Data.Int.Base using (pos)

postulate
  -- SLâ‚‚(â„¤) as a group
  SLâ‚‚â„¤ : Group lzero
  SLâ‚‚â„¤-underlying : âŒ SLâ‚‚â„¤ âŒŸ â‰¡ SLâ‚‚â„¤-carrier

  -- MÃ¶bius group PSLâ‚‚(â„¤) = SLâ‚‚(â„¤) / {Â±I}
  PSLâ‚‚â„¤ : Group lzero
  PSLâ‚‚â„¤-is-quotient : {!!}  -- PSLâ‚‚â„¤ â‰¡ SLâ‚‚â„¤ / âŸ¨-IâŸ©
    -- where -I is the matrix (mat -1 0 0 -1)

  -- Quotient maps (homomorphisms)
  Bâ‚ƒ/Câ†’PSLâ‚‚â„¤ : Groups.Hom Bâ‚ƒ/C PSLâ‚‚â„¤  -- Quotient by aÂ²
  Bâ‚ƒ/Câ†’SLâ‚‚â„¤ : Groups.Hom Bâ‚ƒ/C SLâ‚‚â„¤    -- Quotient by aâ´

  -- SLâ‚‚â„¤ covers PSLâ‚‚â„¤ (2-to-1 covering)
  SLâ‚‚â„¤â†’PSLâ‚‚â„¤ : Groups.Hom SLâ‚‚â„¤ PSLâ‚‚â„¤
  SLâ‚‚â„¤-double-cover : {!!}  -- Kernel is {Â±I}, degree 2

{-|
## Symmetric Group ğ”–â‚ƒ

> "The quotient ğ”–â‚ƒ of Bâ‚ƒ is defined by the relations Ïƒâ‚Â² = Ïƒâ‚‚Â² = 1, and by
>  the relation which defines Bâ‚ƒ, i.e. Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ = Ïƒâ‚‚Ïƒâ‚Ïƒâ‚‚." (p. 107)

**Symmetric group**: Permutations of 3 elements {1, 2, 3}
- |ğ”–â‚ƒ| = 6
- Generated by transpositions (1 2), (2 3)

**Quotient map**: Bâ‚ƒ â†’ ğ”–â‚ƒ
- Ïƒâ‚ â†¦ (1 2) (swap strands 1 and 2)
- Ïƒâ‚‚ â†¦ (2 3) (swap strands 2 and 3)
- Forgets "over/under" crossing information

**Kernel**: Pure braid group Pâ‚ƒ (braids that permute trivially)
-}

-- Symmetric group ğ”–â‚ƒ: permutations of 3 elements
-- We can define it as permutations of Fin 3
open import Data.Fin.Base using (Fin)

-- Permutation type (bijection Fin 3 â†’ Fin 3)
ğ”–â‚ƒ-carrier : Type
ğ”–â‚ƒ-carrier = Î£[ f âˆˆ (Fin 3 â†’ Fin 3) ] (is-equiv f)

postulate
  -- Symmetric group ğ”–â‚ƒ
  ğ”–â‚ƒ : Group lzero
  ğ”–â‚ƒ-underlying : âŒ ğ”–â‚ƒ âŒŸ â‰ƒ ğ”–â‚ƒ-carrier
  ğ”–â‚ƒ-order-6 : {!!}  -- Cardinality |ğ”–â‚ƒ| = 6 (should be provable)

  -- Quotient map Bâ‚ƒ â†’ ğ”–â‚ƒ (group homomorphism)
  Bâ‚ƒâ†’ğ”–â‚ƒ : Groups.Hom Bâ‚ƒ-Group ğ”–â‚ƒ

  -- Generator images (where Ïƒâ‚ â†¦ (1 2) and Ïƒâ‚‚ â†¦ (2 3))
  Bâ‚ƒâ†’ğ”–â‚ƒ-Ïƒâ‚ : {!!}  -- Bâ‚ƒâ†’ğ”–â‚ƒ .fst (gen Ïƒâ‚) â‰¡ transposition 0 1
  Bâ‚ƒâ†’ğ”–â‚ƒ-Ïƒâ‚‚ : {!!}  -- Bâ‚ƒâ†’ğ”–â‚ƒ .fst (gen Ïƒâ‚‚) â‰¡ transposition 1 2

  -- Relations in ğ”–â‚ƒ: generators have order 2
  ğ”–â‚ƒ-relation-1 : {!!}  -- Bâ‚ƒâ†’ğ”–â‚ƒ .fst (gen Ïƒâ‚ âˆ˜ gen Ïƒâ‚) â‰¡ identity
  ğ”–â‚ƒ-relation-2 : {!!}  -- Bâ‚ƒâ†’ğ”–â‚ƒ .fst (gen Ïƒâ‚‚ âˆ˜ gen Ïƒâ‚‚) â‰¡ identity

  -- Pure braid group Pâ‚ƒ (kernel of Bâ‚ƒ â†’ ğ”–â‚ƒ)
  -- Pâ‚ƒ consists of braids that don't permute the strands
  Pâ‚ƒ : Group lzero
  Pâ‚ƒ-is-kernel : {!!}  -- Pâ‚ƒ â‰¡ ker(Bâ‚ƒâ†’ğ”–â‚ƒ)

--------------------------------------------------------------------------------
-- Â§4.4: Fundamental Groupoid Î (Î›â˜…)

{-|
## Groupoid Structure

> "It is more convenient to consider the fundamental groupoid Î (Î›â˜…_â„‚) = Bâ‚ƒ,
>  which is a category, having for points the elements of Î›â˜…_â„‚ and arrows the
>  homotopy classes of paths between two points." (p. 106)

**Fundamental groupoid Î (Î›â˜…)**:
- Objects: Points Î» âˆˆ Î›â˜… (parameters away from discriminant)
- Morphisms: Hom(Î», Î»') = homotopy classes of paths from Î» to Î»'
- Composition: Path concatenation
- Automorphisms: Aut(Î») = Ï€â‚(Î›â˜…; Î») â‰… Bâ‚ƒ

**Key property**: All Aut(Î») are isomorphic (connected groupoid)

**Advantage over groups**:
- No arbitrary basepoint choice
- Natural for varying parameters (DNN forward pass!)
- Morphisms track how roots evolve along input sequences
-}

-- Complex parameter space Î›â˜… (discriminant complement)
postulate
  â„‚ : Type  -- Complex numbers
  Î›â˜…-complex : Type  -- { (u,v) âˆˆ â„‚Â² | discriminant(u,v) â‰  0 }

-- Homotopy class of paths between points
postulate
  PathHomotopy : (X : Type) â†’ X â†’ X â†’ Type
  PathHomotopy-is-set : âˆ€ X x y â†’ is-set (PathHomotopy X x y)

-- Fundamental groupoid Î (Î›â˜…)
postulate
  Î [Î›â˜…] : Groupoid lzero lzero

  -- Objects are points in Î›â˜…
  Î [Î›â˜…]-Ob : Ob Î [Î›â˜…] â‰ƒ Î›â˜…-complex

  -- Morphisms are homotopy classes of paths
  Î [Î›â˜…]-Hom : âˆ€ (Î» Î»' : Ob Î [Î›â˜…])
            â†’ Hom Î [Î›â˜…] Î» Î»' â‰ƒ PathHomotopy Î›â˜…-complex (Î [Î›â˜…]-Ob .fst Î») (Î [Î›â˜…]-Ob .fst Î»')

  -- Automorphisms are isomorphic to Bâ‚ƒ
  -- (fundamental group at any basepoint is Bâ‚ƒ)
  Î [Î›â˜…]-Aut : âˆ€ (Î» : Ob Î [Î›â˜…])
            â†’ Aut Î [Î›â˜…] Î» â‰ƒ Bâ‚ƒ-Group

  -- Groupoid is connected (any two points are connected by a path)
  Î [Î›â˜…]-connected : âˆ€ (Î» Î»' : Ob Î [Î›â˜…]) â†’ âˆ¥ Hom Î [Î›â˜…] Î» Î»' âˆ¥

{-|
**DNN Interpretation**:

When processing sequence xâ‚, xâ‚‚, ..., x_T:
- Each x_t â†’ (u_t, v_t) âˆˆ Î›â˜…
- Path (uâ‚,vâ‚) â†’ (uâ‚‚,vâ‚‚) â†’ ... â†’ (u_T,v_T)
- Homotopy class = braid element in Bâ‚ƒ
- **Meaning emerges from the path**, not just endpoints!

Example: "This book is not uninteresting"
- Start: IE (organizing center)
- Path through E (not interesting)
- End near I (interesting)
- **Braid**: Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ (full loop)
- **Meaning**: More than just "interesting" (enriched by path!)

This is Culioli's "cam model" formalized!
-}

--------------------------------------------------------------------------------
-- Â§4.4: Groupoid Bâ‚ƒ(â„) - Real Points with Complex Paths

{-|
## Bâ‚ƒ(â„): Compromise Between Real and Complex

> "The disadvantage of the complex numbers is the difficulty to compute with
>  them in DNNs, for instance Ïƒ and tanh extended to â„‚ have poles. Moreover
>  all the dynamical regions are confounded in Î›â˜…_â„‚; in some sense the room
>  is too wide. Therefore, we will limit ourselves to the sub-category Î R = Bâ‚ƒ(â„),
>  made by the real points of Î›â˜…, but retaining all the morphisms between them,
>  that is a full sub-category of Bâ‚ƒ." (p. 107)

**Definition**: Bâ‚ƒ(â„)
- Objects: Real points Î›â˜…(â„) = {(u,v) âˆˆ â„Â² | discriminant(u,v) â‰  0}
- Morphisms: ALL morphisms from Î (Î›â˜…_â„‚) (including complex paths!)
- **Full subcategory**: Retains all arrows between real points

**Interpretation**:
> "This means that only the paths are imaginary in Bâ‚ƒ(â„)."

**Advantages**:
- Computable: Parameters u, v are real
- Complete: Can still track root monodromy via complex paths
- Practical: DNNs work with real numbers, semantics needs complex structure
-}

-- Real points of Î›â˜…
Î›â˜…-real : Type
Î›â˜…-real = Î£[ u âˆˆ â„ ] Î£[ v âˆˆ â„ ] (discriminant u v â‰  0.0)

-- Groupoid Bâ‚ƒ(â„): real points with complex morphisms
postulate
  Bâ‚ƒâ„ : Groupoid lzero lzero

  -- Objects: Real points
  Bâ‚ƒâ„-Ob : Ob Bâ‚ƒâ„ â‰ƒ Î›â˜…-real

  -- Inclusion functor (embedding into complex groupoid)
  Bâ‚ƒâ„-inclusion : Functor Bâ‚ƒâ„ Î [Î›â˜…]

  -- Full subcategory: all morphisms between real points are preserved
  Bâ‚ƒâ„-full : âˆ€ (Î» Î»' : Ob Bâ‚ƒâ„)
           â†’ is-equiv (Bâ‚ƒâ„-inclusion .Functor.Fâ‚ {Î»} {Î»'})

  -- Morphisms are the same as in Î [Î›â˜…] (complex paths between real points)
  Bâ‚ƒâ„-Hom : âˆ€ (Î» Î»' : Ob Bâ‚ƒâ„)
          â†’ Hom Bâ‚ƒâ„ Î» Î»' â‰ƒ Hom Î [Î›â˜…] (Bâ‚ƒâ„-inclusion .Functor.Fâ‚€ Î») (Bâ‚ƒâ„-inclusion .Functor.Fâ‚€ Î»')

{-|
**Why Full Subcategory Matters**:

Restricting just objects to reals but keeping all morphisms means:
- We can track paths (uâ‚,vâ‚) â†’ (uâ‚‚,vâ‚‚) with u_i, v_i âˆˆ â„
- Path may go through complex parameters temporarily
- Homotopy class still well-defined
- All braid operations available

This is exactly what happens in semantic processing:
- Input x_t âˆˆ â„â¿ â†’ (u_t, v_t) âˆˆ â„Â²
- Meaning involves "imaginary" intermediate states
- Final hidden state h_t âˆˆ â„áµ is real
-}

--------------------------------------------------------------------------------
-- Â§4.4: Culioli Groupoid BÂ³áµ£ = Î áµ£

{-|
## The Culioli Groupoid

> "Another sub-groupoid could be also useful: consider the gathered surface Î£
>  in Î› Ã— â„ of equation zÂ³ + uz + v = 0; let Î”â‚ƒ be the natural lifting of Î”
>  along the folding lines of Î£ over Î›, the complement Î£â˜… of Î”â‚ƒ in Î£ can be
>  canonically embedded in the complex universal covering Î›Ìƒâ˜…." (p. 107)

**Construction**:
- Take Î£â˜… = Î£ \ Î”â‚ƒ (non-fold points of gathered surface)
- For Î» in contractile region Î›â‚€ inside cusp:
  - Î»âº: Point via path Ïƒâº = Ïƒâ‚
  - Î»â»: Point via path Ïƒâ» = Ïƒâ‚‚
- When Î» approaches cusp branch, one point collides with Î”â‚ƒ, other stays isolated

**Culioli groupoid** BÂ³áµ£ = Î áµ£:
- Objects: Points of Î£â˜…
- Morphisms: Homotopy classes of paths in universal covering
- **Covering functor**: Ï€: BÂ³áµ£ â†’ Bâ‚ƒ(â„)

**Key feature**:
> "The interest of BÂ³áµ£ with respect to Bâ‚ƒ(â„) is that it distinguishes between
>  the stable minimum and the unstable one in the regime u < 0." (p. 107)

**Why "Culioli"**:

> "The convenient representation of the moves of Culioli is in the groupoid BÂ³áµ£,
>  that we propose to name the Culioli groupoid." (p. 110)

This groupoid captures the full semantic structure:
- Interior I, Exterior E, Boundary B
- Organizing center IE (on Î”â‚ƒ)
- Distinguishes attractor from repulsor
- Paths = semantic operations

See Section 4.5 for details!
-}

-- Culioli groupoid BÂ³áµ£ over the gathered surface
postulate
  BÂ³áµ£ : Groupoid lzero lzero

  -- Objects: Points of Î£â˜… (gathered surface minus folds)
  BÂ³áµ£-Ob : Ob BÂ³áµ£ â‰ƒ Î£â˜…

  -- Covering functor Ï€: BÂ³áµ£ â†’ Bâ‚ƒ(â„)
  -- Projects points on gathered surface to parameters
  Ï€-covering : Functor BÂ³áµ£ Bâ‚ƒâ„

  -- Fiber structure: points over (u,v) with u < 0
  -- In the regime u < 0, there are two minima: stable and unstable
  Fiber : Î›â˜…-real â†’ Type
  fiber-over : âˆ€ (Î» : Ob Bâ‚ƒâ„) â†’ Fiber (Bâ‚ƒâ„-Ob .fst Î»)
             â‰ƒ Î£[ x âˆˆ Ob BÂ³áµ£ ] (Ï€-covering .Functor.Fâ‚€ x â‰¡ Î»)

  -- Distinguishes stable/unstable branches
  distinguishes-branches : âˆ€ (uv : Î›â˜…-real)
                         â†’ (uv .fst < 0.0)  -- u < 0 (inside cusp)
                         â†’ Î£[ stable âˆˆ Ob BÂ³áµ£ ] Î£[ unstable âˆˆ Ob BÂ³áµ£ ]
                           (Ï€-covering .Functor.Fâ‚€ stable â‰¡ Bâ‚ƒâ„-Ob .snd uv)
                           Ã— (Ï€-covering .Functor.Fâ‚€ unstable â‰¡ Bâ‚ƒâ„-Ob .snd uv)
                           Ã— (stable â‰  unstable)

  -- Four-point simplification (representative points)
  -- One point outside cusp, three inside
  four-points : Î£[ outside âˆˆ Ob BÂ³áµ£ ] Î£[ insideâ‚ âˆˆ Ob BÂ³áµ£ ] Î£[ insideâ‚‚ âˆˆ Ob BÂ³áµ£ ] Î£[ insideâ‚ƒ âˆˆ Ob BÂ³áµ£ ]
                {!!}  -- Constraints on these points

  -- Looijenga's real structures correspondence
  looijenga-correspondence : {!!}  -- Four points â†” real structures [Loo78]

{-|
**Comparison of Groupoids**:

| Groupoid | Objects | Morphisms | Distinguishes | Use Case |
|----------|---------|-----------|---------------|----------|
| Î (Î›â˜…_â„‚) | Complex Î» | Complex paths | Full monodromy | Theory |
| Bâ‚ƒ(â„) | Real (u,v) | Complex paths | Computable params | DNNs |
| BÂ³áµ£ | Points on Î£â˜… | Paths in Î£â˜… | Stable/unstable | Semantics |

**Which to use?**:
- **Computation**: Bâ‚ƒ(â„) (real parameters, complex structure)
- **Semantics**: BÂ³áµ£ (Culioli notional domains)
- **Theory**: Î (Î›â˜…_â„‚) (full generality)

All are connected groupoids with Aut(Â·) â‰… Bâ‚ƒ!
-}

-- Simplified version (4 representative points)
-- This is a finite groupoid with 4 objects representing the key semantic regions
postulate
  BÂ³áµ£-simplified : Groupoid lzero lzero
  simplified-objects : Ob BÂ³áµ£-simplified â‰ƒ Fin 4
    -- 0: Outside cusp (Exterior E)
    -- 1: Inside cusp, stable (Interior I)
    -- 2: Inside cusp, unstable (organizing center IE)
    -- 3: Boundary region

  simplified-covers : Functor BÂ³áµ£-simplified BÂ³áµ£
  simplified-full-faithful : {!!}  -- This should be a full and faithful embedding

--------------------------------------------------------------------------------
-- Â§4.4: Quotient Groupoids

{-|
## Quotients by Normal Subgroups

> "All these groupoids are connected, the two first ones, Bâ‚ƒ(â„) and BÂ³áµ£ because
>  they are full subcategories of the connected groupoid Bâ‚ƒ, the other ones in
>  virtue of the definition of a quotient (to the right) of a groupoid by a
>  normal sub-group H of its fundamental group G." (p. 107)

**Quotient construction**:
- Start with connected groupoid ğ’¢
- Let H âŠ² Aut(a) be normal subgroup for each object a
- Quotient groupoid ğ’¢/H:
  - Same objects as ğ’¢
  - Morphisms: f ~ g iff fâ»Â¹g âˆˆ H_a (right cosets)

**Well-defined**: H normal â‡’ H_a, H_b related by conjugation

**Examples**:
- Î (Î›â˜…) / C â†’ groupoid with Aut(Â·) â‰… Bâ‚ƒ/C
- Î (Î›â˜…) / Pâ‚ƒ â†’ groupoid with Aut(Â·) â‰… ğ”–â‚ƒ
- Bâ‚ƒ(â„) / âŸ¨aÂ²âŸ© â†’ groupoid with Aut(Â·) â‰… PSLâ‚‚(â„¤)
-}

-- Normal subgroup type (for each object, a normal subgroup of automorphisms)
NormalSubgroupFamily : (ğ’¢ : Groupoid lzero lzero) â†’ Typeâ‚
NormalSubgroupFamily ğ’¢ = âˆ€ (x : Ob ğ’¢) â†’ Î£[ H âˆˆ (Aut ğ’¢ x â†’ Type) ]
                           {!!}  -- H is a normal subgroup

-- Quotient groupoid construction
-- Same objects, but morphisms modulo normal subgroup action
postulate
  _//_ : (ğ’¢ : Groupoid lzero lzero) â†’ NormalSubgroupFamily ğ’¢ â†’ Groupoid lzero lzero

  -- Quotient by center C
  Î [Î›â˜…]/C : Groupoid lzero lzero
  Î [Î›â˜…]/C-def : Î [Î›â˜…]/C â‰¡ {!!}  -- Î [Î›â˜…] // (Î» x â†’ C)
  Î [Î›â˜…]/C-aut : âˆ€ Î» â†’ Aut Î [Î›â˜…]/C Î» â‰ƒ Bâ‚ƒ/C

  -- Quotient to symmetric group (quotient by pure braid group)
  Î [Î›â˜…]/Pâ‚ƒ : Groupoid lzero lzero
  Î [Î›â˜…]/Pâ‚ƒ-def : Î [Î›â˜…]/Pâ‚ƒ â‰¡ {!!}  -- Î [Î›â˜…] // (Î» x â†’ Pâ‚ƒ)
  Î [Î›â˜…]/Pâ‚ƒ-aut : âˆ€ Î» â†’ Aut Î [Î›â˜…]/Pâ‚ƒ Î» â‰ƒ ğ”–â‚ƒ

  -- Quotient to modular group
  Bâ‚ƒâ„/âŸ¨aÂ²âŸ© : Groupoid lzero lzero
  Bâ‚ƒâ„/âŸ¨aÂ²âŸ©-def : Bâ‚ƒâ„/âŸ¨aÂ²âŸ© â‰¡ {!!}  -- Bâ‚ƒâ„ // (Î» x â†’ subgroup generated by aÂ²)
  Bâ‚ƒâ„/âŸ¨aÂ²âŸ©-aut : âˆ€ Î» â†’ Aut Bâ‚ƒâ„/âŸ¨aÂ²âŸ© Î» â‰ƒ PSLâ‚‚â„¤

{-|
**Natural groupoids smaller than Bâ‚ƒ**:

Quotienting morphisms (not objects!) gives hierarchy:

Bâ‚ƒ â†’ Bâ‚ƒ/C â†’ PSLâ‚‚(â„¤) â†’ ...
  â†˜ ğ”–â‚ƒ

Each level loses information:
- Bâ‚ƒ: Full braid structure
- Bâ‚ƒ/C: Forget full twist
- PSLâ‚‚(â„¤): Modular forms
- ğ”–â‚ƒ: Just permutations (forget over/under)

For DNNs: Choice depends on task complexity!
-}

--------------------------------------------------------------------------------
-- Â§4.4: Representations

{-|
## Linear Representations of Bâ‚ƒ

### 1. Cardan Representation

> "Cardan formulas expresses the roots by using square roots and cubic roots.
>  They give explicit formulas for the differences of roots zâ‚‚ - zâ‚, zâ‚ƒ - zâ‚.
>  They can be seen directly in the surface Î£." (p. 108)

**Construction**:
- Integral classes of Hâ‚€(Pâ»Â¹_{u,v}(0)) transported along paths
- Integrate holomorphic form dz on integral classes
- Gives **linear representation** Ï: Bâ‚ƒ â†’ GLâ‚‚(â„)
- Factorizes through ğ”–â‚ƒ

**Meaning**: Track differences of roots (relative positions)

### 2. Elliptic Representation

> "Augment the variable z by a variable y, the roots can be completed by the
>  levels Z_{u,v} over (u,v) âˆˆ Î›, which are the elliptic curves
>    P_{u,v}(z,y) = zÂ³ + yÂ² + uz + v = 0" (Eq 4.31)

**Holomorphic 2-form** (Eq 4.32):
  Ï‰ = dz âˆ§ dy = -(1/2) dP âˆ§ (dz/y)

**Elliptic integral**: âˆ«_{cycle} dz/y over Z_{u,v}

**Periods**: Give **linear representation** Ï: Bâ‚ƒ â†’ SLâ‚‚(â„¤)

**Connection to modular forms**:
- j-invariant of elliptic curve
- Modular forms on â„/PSLâ‚‚(â„¤)
- Moonshine, string theory, ...

**Why it matters for DNNs**:
- Elliptic curves = genus 1 Riemann surfaces
- Periods = "winding numbers" of meaning
- Modular group = symmetries of semantic space
-}

postulate
  -- Cardan representation
  cardan-repr : Bâ‚ƒ â†’ {!!}  -- GLâ‚‚(â„)
  cardan-factorizes-ğ”–â‚ƒ : {!!}

  -- Root differences
  root-diff : â„ â†’ â„ â†’ {!!}  -- (u,v) â†’ (zâ‚‚-zâ‚, zâ‚ƒ-zâ‚)

  -- Elliptic curve
  Elliptic-Curve : â„ â†’ â„ â†’ Type
  elliptic-equation : âˆ€ u v â†’ Elliptic-Curve u v â‰ƒ {!!}  -- zÂ³ + yÂ² + uz + v = 0

  -- Holomorphic form
  Ï‰ : {!!}  -- 2-form dz âˆ§ dy
  Ï‰-factorization : {!!}  -- Ï‰ = -(1/2) dP âˆ§ (dz/y)

  -- Elliptic representation
  elliptic-repr : Bâ‚ƒ â†’ SLâ‚‚â„¤
  periods-give-repr : {!!}

{-|
### Stabilization and Higher Dimensions

> "Every stabilization of zÂ³ by a quadratic form gives rise to the representation
>  of the first case in odd dimension and of the second case in even dimension."
>  (p. 108)

**Stabilization**: Add variables to make function non-degenerate

**Examples**:
- zÂ³ + xÂ² â†’ Representation in dimension 2 (odd)
- zÂ³ + yÂ² â†’ Elliptic case in dimension 2 (even)
- zÂ³ + wÂ² + xÂ² + ... â†’ Higher-dimensional representations

**Pattern**:
- Odd dimension: Factorizes through ğ”–â‚ƒ
- Even dimension: Factorizes through SLâ‚‚(â„¤) or variants

This connects to higher catastrophes (A_n, D_n series) in Section 4.5!
-}

--------------------------------------------------------------------------------
-- Summary: Braid Structure of Semantics

{-|
## The Braid Group Hierarchy

```
         Bâ‚ƒ
        / | \
       /  |  \
      /   |   \
   Bâ‚ƒ/C   |   ğ”–â‚ƒ
    / \   |
   /   \  |
PSLâ‚‚â„¤  SLâ‚‚â„¤
```

**Interpretations**:
- **Bâ‚ƒ**: Full semantic structure (all ambiguities)
- **Bâ‚ƒ/C**: Forget full rotations
- **PSLâ‚‚(â„¤)**: Modular structure (periods of meaning)
- **SLâ‚‚(â„¤)**: With orientation
- **ğ”–â‚ƒ**: Just permutations (minimal structure)

**For DNNs**:
- Parameters (u,v) âˆˆ Î›â˜…(â„) are **computable**
- Paths give **braid elements** (semantic operations)
- Groupoid structure = **context-dependent meaning**
- Representations = **quantitative measures of semantics**

**Connection to Section 4.5**:
- Culioli notional domains = regions in Î› separated by Î”
- Semantic operations = braid paths
- "This book is not uninteresting" = Ïƒâ‚Ïƒâ‚‚Ïƒâ‚ (full braid)
- Catastrophe points on Î” = organizing centers (IE)

This is **algebraic topology explaining linguistic meaning**!
-}
